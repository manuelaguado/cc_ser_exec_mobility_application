function startGps(){storeGps(function(){var b=dataBase.result.transaction(["gps"],"readonly"),a=[];b.objectStore("gps").openCursor().onsuccess=function(b){b=b.target.result;null!==b&&b&&20>a.length&&(b.value.id_operador=id_operador,b.value.proceso="gps",a.push(b.value),b["continue"]())};b.oncomplete=function(){var b=JSON.stringify(a);jQuery.isPlainObject(a[0])&&$.ajax({url:"mobile/gps",type:"POST",dataType:"json",data:"gps="+b+"&tknses="+token_session,success:function(a){"ok"==a.gps&&(a=JSON.parse(b),
$.each(a,function(a,b){eliminarClaveByToken(b.token,"gps")}))}})};last_lat=lat;last_lon=lon})}
function startSync(b){var a=dataBase.result.transaction(["claves"],"readonly"),c=[];a.objectStore("claves").openCursor().onsuccess=function(a){a=a.target.result;null!==a&&(a.value.latitud_act=lat,a.value.longitud_act=lon,a.value.proceso="sync",c.push(a.value),a["continue"]())};a.oncomplete=function(){var a=JSON.stringify(c);jQuery.isPlainObject(c[0])?$.ajax({url:"mobile/sync",type:"POST",dataType:"json",data:"sync="+a+"&tknses="+token_session,success:function(a){b()}}):b()}}
function sync_ok(b){b=JSON.parse(b);$.each(b,function(a,b){1==b.resp&&eliminarClaveByToken(b.token,"claves")});switch(b[0].clave){case "C1":storeTravel(b[0])}}function gps_ok(b){b=JSON.parse(b);$.each(b,function(a,b){1==b.resp&&eliminarClaveByToken(b.token,"gps")})}function broadcastPlay(b){b=JSON.parse(b);timbre.play();myApp.alert(b.mensaje,"Notificaci\u00f3n general",function(){timbre.pause()})}
function print_travel(b,a){a=void 0===a?!1:a;$("#data_viaje").html("");$.each(b,function(a,b){if(""!=b)switch(a){case "tipo_servicio":case "status_viaje":case "fecha_solicitud":case "fecha_asignacion":break;case "id_viaje":$("#data_viaje").append('<div class="id_head_key">'+b+"</div>");break;default:$("#data_viaje").append('<div class="card"><div class="card-header" style="color:#000000;">'+a+'</div><div class="card-content"><div class="card-content-inner">'+b+"</div></div></div>")}});a&&rideSound.play();
storageRide(b,function(){})}
function ride_ok(b){var a=JSON.parse(b);switch(a.clave){case "R1":myApp.alert("Se sincronizar\u00e1 el estado de su movil con la central ","Atenci\u00f3n",function(){"inicio"==a.set_page?(setStoreVariable("base","",function(){}),$("#data_cordon").html("NO HAY DATOS DE CORDON"),finalizar_servicio()):"regreso"==a.set_page?storeClave("C1","C1","F11","NULL","NULL","NULL",function(){"regreso"!=currentPage&&loadTemplate("regreso");$("#data_viaje").html("");$("#data_cordon").html("");$("#air_service_act").hide();
$("#air_service_des").show();$("#request_queue_des").hide();$("#request_queue_act").show();$("#fin_labores_des").hide();$("#fin_labores_act").show();$("#tomar_apartado_des").show();$("#tomar_apartado_act").hide()}):loadTemplate(a.set_page)});break;case "R11":case "A10":1==a["new"]?($("#data_cordon").html("NO HAY DATOS DE CORDON"),storeTravel(a),$("#ride_false").hide(),$("#ride_true").show(),updatePageButtons("ride_false","ride_true"),$("#exit_true").hide(),$("#exit_false").show(),updatePageButtons("exit_true",
"exit_false"),print_travel(a.viaje,!0),myApp.alert("Vea los detalles de su destino en el men\u00fa","Nuevo destino",function(){rideSound.pause()}),getBase(function(){storeClave("R5","C1",globalBase,"NULL","NULL","ACUSE DE RECEPCION DE A10",function(){})})):($("#ride_true").hide(),$("#ride_false").show(),updatePageButtons("ride_true","ride_false"));break;case "C6":$("div[id ^= cancel_des_]").hide();$("div[id ^= cancel_act_]").show();updatePageButtons("cancel_des_","cancel_act_");myApp.alert("Se ha activado la opci\u00f3n para cancelar su servicio de manera remota, ahora puede cancelarlo",
"Solicitud de cancelaci\u00f3n");storeClave("R12","C1","NULL","NULL","NULL","ACUSE DE RECEPCION DE C6",function(){});break;case "A14":$("div[id ^= abandono_des_]").hide();$("div[id ^= abandono_act_]").show();updatePageButtons("abandono_des_","abandono_act_");myApp.alert("Se ha activado la opci\u00f3n para abandonar su servicio de manera remota, ahora puede abandonarlo","Solicitud de abandono");storeClave("R13","C1","NULL","NULL","NULL","ACUSE DE RECEPCION DE A14",function(){});break;case "F15":1==
a["new"]?($("#data_cordon").html("NO HAY DATOS DE CORDON"),storeTravel(a),$("#air_service_des").hide(),$("#air_service_act").show(),updatePageButtons("air_service_des","air_service_act"),$("#request_queue_act").hide(),$("#request_queue_des").show(),updatePageButtons("request_queue_act","request_queue_des"),$("#fin_labores_act").hide(),$("#fin_labores_des").show(),updatePageButtons("fin_labores_act","fin_labores_des"),$("#tomar_apartado_act").hide(),$("#tomar_apartado_des").show(),updatePageButtons("tomar_apartado_act",
"tomar_apartado_des"),print_travel(a.viaje,!0),myApp.alert("Vea los detalles de su destino en el men\u00fa","Servicio al aire",function(){rideSound.pause()}),storeClave("R6","C1","NULL","NULL","NULL","ACUSE DE RECEPCION DE F15",function(){})):($("#air_service_act").hide(),$("#air_service_des").show(),updatePageButtons("air_service_act","air_service_des"));break;case "A19":1==a["new"]?($("#data_cordon").html("NO HAY DATOS DE CORDON"),storeTravel(a),$("#air_service_des").show(),$("#air_service_act").hide(),
$("#request_queue_act").hide(),$("#request_queue_des").show(),$("#fin_labores_act").hide(),$("#fin_labores_des").show(),$("#tomar_apartado_act").show(),$("#tomar_apartado_des").hide(),updatePageButtons("tomar_apartado_des","tomar_apartado_act"),print_travel(a.viaje,!0),myApp.alert("Vea los detalles de su destino en el men\u00fa","Servicio programado",function(){rideSound.pause()}),storeClave("R14","C1","NULL","NULL","NULL","ACUSE DE RECEPCION DE F15",function(){})):($("#tomar_apartado_des").show(),
$("#tomar_apartado_act").hide(),updatePageButtons("tomar_apartado_act","tomar_apartado_des"));break;case "F13":1==a["new"]?($("#data_cordon").html("NO HAY DATOS DE CORDON"),storeTravel(a),$("#salida_sitio_des").hide(),$("#salida_sitio_act").show(),updatePageButtons("salida_sitio_des","salida_sitio_act"),print_travel(a.viaje,!0),myApp.alert("Se autoriz\u00f3 la salida por sitio","Salida por sitio",function(){rideSound.pause()}),getBase(function(){storeClave("R7","C1",globalBase,"NULL","NULL","ACUSE DE RECEPCION DE F13",
function(){})})):($("#salida_sitio_act").hide(),$("#salida_sitio_des").show(),updatePageButtons("salida_sitio_act","salida_sitio_des"));break;case "F14":1==a.queue?($("#update_cordon").css("display","none"),loadTemplate("base"),setStoreVariable("base",a.base,function(){}),myApp.alert("Turno: "+a.turno+"<br><br>Verifique el cord\u00f3n en el men\u00fa para conocer el estado.","Asignado al cord\u00f3n"),$("#data_cordon").html(""),$("#data_viaje").html(""),$.each(a.cordon,function(a,b){suma=parseInt(a)+
1;$("#data_cordon").append('<div class="user-tail"><span id="ava-tail" class="circle_back"><img class="avatar_tail" src="'+url_app+'fw7/assets/img/driver-black.svg" alt="Operador"><div class="cordon_name">'+suma+".-"+b+"</div></span></div>")}),storeClave("R8","C1","NULL","NULL","NULL","ACUSE DE RECEPCION DE F14",function(){})):0==a.queue&&($("#update_cordon").css("display",""),b=JSON.parse(JSON.stringify(a.indicadores)),b=myApp.indicadores(b),$("#data_cordon").html(b));break;case "F19":setCordonDual(a);
storeClave("R2","C1","NULL","NULL","NULL","ACUSE CORDON",function(){});break;case "F20":$("#exit_true").show();$("#exit_false").hide();updatePageButtons("exit_false","exit_true");break;case "C1":storeTravel(a);setStoreVariable("episodio",a.id_episodio,function(){});storeClave("R10","C1","F11","NULL","NULL","ACUSE DE RECEPCION DE C1",function(){});break;case "MSG":storeClave("F17","C1",""+a.id_mensaje+"","NULL","NULL","Mensaje Leido",function(){timbre.play();myApp.alert(a.mensaje,"Mensaje",function(){timbre.pause()})});
break;case "R3":dOut();break;case "R4":dOut()}}
function setCordonDual(b){0==b["new"]&&($("#data_cordon").html(""),$.each(b.cordon,function(a,b){suma=parseInt(a)+1;$("#data_cordon").append('<div class="user-tail"><span id="ava-tail" class="circle_back"><img class="avatar_tail" src="'+url_app+'fw7/assets/img/driver-black.svg" alt="Operador"><div class="cordon_name">'+suma+".-"+b+"</div></span></div>")}),cordonSound.play(),storageCordon(b,function(){}));3>=b.turno?($("#exit_true").hide(),$("#exit_false").show(),updatePageButtons("exit_true","exit_false")):
($("#exit_true").show(),$("#exit_false").hide(),updatePageButtons("exit_false","exit_true"))}var initSync=setInterval("startSync(function(){})",1E3),initGps=setInterval("startGps()",5E3),intervalsLoaded=!0;